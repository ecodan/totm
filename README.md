# TOTM: Theater of the Mind ðŸŽ­

> **A Reference Implementation of the Cicadas Methodology**

TOTM is a text-based RPG engine where an **AI Game Master** dynamically narrates an adventure while adhering to a deterministic rule system. It demonstrates the **Split-Brain Architecture**: creative freedom (LLM) constrained by mechanical truth (Code).

This project was built entirely by autonomous AI agents using the **Chorus** orchestrator.

## Features

-   **Creative AI Narrator**: Powered by `litellm` (supporting Gemini, Claude, GPT), the GM describes scenes, voices NPCs, and improvises dialogue.
-   **Deterministic Engine**: A graph-based world state and d20 rule system ensure fair, consistent gameplay.
-   **Arbiter Tools**: The bridge that allows the AI to "see" and "act" in the game world without hallucinating state.
-   **Terminal Interface**: A retro-modern localized shell with rich text formatting.

## Installation

Ensure you have Python 3.12+ installed.

1.  **Clone the repository**:
    ```bash
    git clone https://github.com/ecodan/totm.git
    cd totm
    ```

2.  **Install dependencies**:
    ```bash
    pip install pydantic litellm
    ```
    *(Note: Add `google-genai` or `anthropic` or `openai` depending on your provider)*

## Usage

1.  **Set your API Key**:
    ```bash
    export GEMINI_API_KEY="your-key-here"
    # OR
    export ANTHROPIC_API_KEY="your-key-here"
    ```

    *Note: Google Cloud Application Default Credentials (ADC) are also supported automatically.*

2.  **Run the Game**:
    ```bash
    PYTHONPATH=src python src/totm/app.py
    ```

3.  **Play**:
    -   **Create Character**: Follow the wizard prompts.
    -   **Start Game**: Type natural language commands like *"Look around"*, *"Go north"*, or *"Talk to the goblin"*.

## Architecture

The system is a Modular Monolith:
-   `src/totm/engine`: Rules & State (The Truth)
-   `src/totm/tools`: API Layer for the Agent
-   `src/totm/agent`: AI Logic & Context Loop
-   `src/totm/ui`: Player Interface

See `.cicadas/canon/` for detailed architectural documentation generated by the agents.
